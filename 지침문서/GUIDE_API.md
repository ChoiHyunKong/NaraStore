# 나라장터 Open API 사용 가이드

## 🎯 개요

이 프로젝트는 **나라장터 Open API**를 사용하여 입찰공고 정보를 조회합니다.
기존 크롤링 방식 대신 안정적이고 빠른 API를 활용합니다.

---

## 📝 API 키 발급 방법

### 1단계: 공공데이터포털 회원가입
1. [공공데이터포털](https://www.data.go.kr/) 접속
2. 회원가입 (간단한 정보 입력 필요)

### 2단계: API 신청
1. [나라장터 입찰공고정보서비스](https://www.data.go.kr/data/15129394/openapi.do) 페이지 접속
2. **"활용신청"** 버튼 클릭
3. 활용목적 입력 (예: "입찰공고 분석 시스템 개발")
4. 신청 완료

### 3단계: API 키 확인
1. 신청 승인 (보통 즉시 또는 1-2시간 내)
2. 마이페이지 > 오픈API > 개발계정 상세보기
3. **인증키(Encoding)** 또는 **일반 인증키** 복사

> ⚠️ **중요**: API 키는 외부에 노출되지 않도록 주의하세요!

---

## 🚀 사용 방법

### 방법 1: Streamlit 웹 앱 사용 (권장)

1. **앱 실행**
   ```bash
   streamlit run app.py
   ```

2. **API 키 입력**
   - "입찰공고 검색/크롤링" 탭 선택
   - "나라장터 API 키 설정" 섹션에서 API 키 입력
   - "저장" 버튼 클릭

3. **검색 실행**
   - 검색어 입력 (예: "인공지능", "챗봇")
   - "검색 시작" 버튼 클릭
   - 결과 확인 및 CSV 다운로드

### 방법 2: Python 코드로 직접 사용

```python
from modules.api_client import NaraAPIClient

# API 클라이언트 생성
api_client = NaraAPIClient("YOUR_API_KEY_HERE")

# 입찰공고 검색
df = api_client.search_bids("인공지능", num_rows=10)
print(df)

# 상세정보 조회
detail = api_client.get_bid_detail("20250101234", "00")
print(detail)
```

### 방법 3: API 엔드포인트 사용

FastAPI 서버를 실행하여 HTTP API로 사용:

```bash
python api.py
```

API 요청 예시:
```bash
curl -X POST "http://localhost:8000/crawl" \
  -H "Content-Type: application/json" \
  -d '{
    "keyword": "인공지능",
    "api_key": "YOUR_API_KEY_HERE"
  }'
```

---

## 🧪 테스트

테스트 스크립트를 실행하여 API가 정상 작동하는지 확인:

1. `test_api_client.py` 파일 열기
2. `API_KEY` 변수에 발급받은 API 키 입력
3. 실행:
   ```bash
   python test_api_client.py
   ```

정상 작동 시 출력 예시:
```
📋 테스트 1: 입찰공고 검색 (키워드: 인공지능)
✅ 성공: 10건의 공고를 찾았습니다.

검색 결과 (처음 5건):
   공고번호     공고명           공고기관      입찰마감일시
0  20250101...  AI 시스템 구축    조달청       2025-01-25 10:00
...
```

---

## ⚙️ 주요 기능

### 제공되는 정보
- ✅ 공고번호, 공고차수
- ✅ 공고명
- ✅ 공고기관, 수요기관
- ✅ 공고일시, 입찰마감일시, 개찰일시
- ✅ 추정가격
- ✅ 재입찰허용여부
- ✅ 참가가능여부
- ✅ 상세링크

### API 제한사항
- 일일 호출 한도: 일반적으로 1,000~10,000건 (계정에 따라 다름)
- 응답 시간: 보통 1-3초
- 한 번에 최대 조회: 100건 (numOfRows 파라미터)

---

## 🔧 문제 해결

### API 키 오류
```
ERROR - API 오류: 03 - SERVICE_KEY_IS_NOT_REGISTERED_ERROR
```
**해결방법**: 
- API 키가 잘못 입력되었거나 승인되지 않았습니다
- 마이페이지에서 API 키 재확인
- 활용신청 승인 대기 중일 수 있습니다

### 검색 결과 없음
```
WARNING - 검색 결과가 없습니다.
```
**해결방법**:
- 다른 키워드로 시도
- 날짜 범위 확인 (API는 최근 데이터만 제공할 수 있음)

### 일일 한도 초과
```
ERROR - API 오류: 99 - LIMITED_NUMBER_OF_SERVICE_REQUESTS_EXCEEDS_ERROR
```
**해결방법**:
- 다음 날 다시 시도
- 필요시 공공데이터포털에 한도 증가 요청

---

## 📊 기존 크롤러와 비교

| 항목 | 기존 크롤러 | Open API |
|------|-------------|----------|
| 속도 | 🐌 10-20초 | ⚡ 1-3초 |
| 안정성 | ❌ 불안정 | ✅ 매우 안정적 |
| 유지보수 | 🔧 지속적 필요 | ✅ 최소한 |
| 데이터 품질 | ⚠️ 파싱 오류 가능 | ✅ 정형화 |
| 법적 리스크 | ⚠️ 약관 확인 필요 | ✅ 공식 제공 |

---

## 💡 팁

1. **환경변수 사용**
   - API 키를 코드에 직접 입력하지 말고 `.env` 파일 사용 권장
   ```
   NARA_API_KEY=your_api_key_here
   ```

2. **에러 핸들링**
   - API 호출 실패 시 재시도 로직 구현 고려
   - 로그를 확인하여 오류 원인 파악

3. **효율적 사용**
   - 필요한 만큼만 조회 (`num_rows` 파라미터 조정)
   - 캐싱 고려 (동일한 검색 결과 재사용)

---

## 📚 참고 자료

- [공공데이터포털](https://www.data.go.kr/)
- [나라장터 입찰공고정보서비스](https://www.data.go.kr/data/15129394/openapi.do)
- [API 명세서 다운로드](https://www.data.go.kr/data/15129394/openapi.do) (페이지에서 문서 다운로드)

---

## ❓ 문의

API 사용 중 문제가 발생하면:
1. 로그 파일 확인
2. `test_api_client.py`로 기본 연결 테스트
3. 공공데이터포털 고객센터: 1566-0025
